name: EverBlue Voice Squad (Flux)
members:
  - assistantId: everblue-main-agent
    assistantOverrides:
      metadata:
        position:
          x: 250
          y: 100
      tools:append:
        - async: false
          destinations:
            - assistantName: EverBlue - Estimate Agent
              description: Silent handoff to Estimate Agent with caller info
              type: assistant
          function:
            name: handoff_to_EverBlue_Estimate_Agent
            description: |-
              Silent handoff to Estimate Agent after:
              1. Caller confirmed this is a NEW project
              2. Collected name, phone, and address
              3. Address verified with resolve_address tool

              You MUST pass all collected information as parameters.
              IMPORTANT: addressUuid is a UUID string - pass it exactly as received, do not parse as number.
            parameters:
              properties:
                addressUuid:
                  description: The Roofr addressUuid obtained from resolve_address tool (UUID v7 format, e.g., "172631c8-8230-4de0-8c83-92d07d5014f7")
                  type: string
                contactName:
                  description: Caller's name as collected during intake
                  type: string
                contactPhone:
                  description: Caller's phone number in E.164 format (e.g., "+12065551234")
                  type: string
              required:
                - contactName
                - contactPhone
                - addressUuid
              type: object
          messages: []
          type: handoff
  - assistantId: everblue-estimate-agent
    assistantOverrides:
      metadata:
        position:
          x: 650
          y: 100
      tools:append:
        - async: false
          destinations:
            - assistantName: EverBlue - Main Agent
              description: Silent handoff back to Main Agent only if caller has complex questions that require knowledge base lookup. For simple questions (hours, areas, website), answer directly.
              type: assistant
          function:
            name: handoff_to_EverBlue_Main_Agent
            description: Silent handoff back to Main Agent only if caller has complex questions that require knowledge base lookup. For simple questions (hours, areas, website), answer directly.
          messages: []
          type: handoff
membersOverrides:
  hooks:
    - do:
        - exact: I'm sorry, I didn't quite catch that. Could you please repeat?
          type: say
      on: assistant.transcriber.endpointedSpeechLowConfidence
      options:
        confidenceMax: 0.49
        confidenceMin: 0.2
    - do:
        - exact: I'll be ending the call now. Please feel free to call back anytime. Have a great day!
          type: say
        - tool:
            type: endCall
          type: tool
      on: customer.speech.timeout
      options:
        timeoutSeconds: 90
  observabilityPlan:
    provider: langfuse
    tags:
      - Roofr
      - squad-v3
      - Flux
  transcriber:
    confidenceThreshold: 0.5
    language: en
    model: flux-general-en
    numerals: true
    provider: deepgram
